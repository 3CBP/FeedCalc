<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dairy TMR Calculator</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="logo.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1565c0">
  <style>
    body{background:#1565c0;color:#fff;font-family:-apple-system,sans-serif;margin:0;padding:20px;}
    header{text-align:center;padding:20px;background:#0d47a1;margin:-20px -20px 30px;}
    .logo{width:80px;height:80px;border-radius:50%;border:4px solid #fff;}
    h1{margin:10px 0;font-size:28px;}
    .tabs{display:flex;gap:10px;margin-bottom:20px;}
    .tab{flex:1;padding:15px;background:rgba(255,255,255,.2);text-align:center;border-radius:8px;cursor:pointer;font-weight:bold;}
    .tab.active{background:#fff;color:#0d47a1;}
    .content{display:none;padding:10px;}
    .content.active{display:block;}
    input,select,button{width:100%;padding:12px;margin:8px 0;border:none;border-radius:8px;font-size:16px;}
    button{background:#ff9800;color:#000;font-weight:bold;cursor:pointer;}
    .add{background:#4caf50;}
    .del{background:#d32f2f;width:auto;padding:8px 16px;font-size:14px;}
    .row{display:flex;gap:10px;align-items:center;margin:10px 0;background:rgba(255,255,255,.1);padding:12px;border-radius:8px;}
    .row span{flex:1;font-weight:bold;}
    .row input[type=number]{width:110px;text-align:center;}
    .result{margin-top:30px;}
    .feedsheet{background:#fff;color:#000;padding:40px;border-radius:20px;border:8px solid #ff9800;box-shadow:0 20px 40px rgba(0,0,0,.5);}
    .loadline{display:flex;justify-content:space-between;font-size:38px;font-weight:900;padding:15px 0;border-bottom:3px dashed #666;}
    .cumulative{font-size:42px;color:#4caf50;text-align:right;margin:20px 0;}
    .big{font-size:70px;color:#ff9800;}
    .ready{background:#d32f2f;color:#fff;padding:25px;font-size:40px;text-align:center;border-radius:15px;animation:glow 1.5s infinite;}
    @keyframes glow{0%,100%{box-shadow:0 0 30px #f00;}50%{box-shadow:0 0 60px #f00;}}
    @media print{.no-print{display:none}body{background:#fff;color:#000}.feedsheet{border:4px solid #000;}}
  </style>
</head>
<body>
<header>
  <img src="logo.jpeg" class="logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iMzYiIGZpbGw9IiNmZmYiIHN0cm9rZT0iI2ZmOTgwMCIgc3Ryb2tlLXdpZHRoPSI4Ii8+CiI8L3N2Zz4K';">
  <h1>Dairy TMR Calculator</h1>
</header>

<div class="tabs no-print">
  <div class="tab active" onclick="openTab('calc')">Calculator</div>
  <div class="tab" onclick="openTab('manage')">Groups & Rations</div>
  <div class="tab" onclick="openTab('feeds')">Ingredients</div>
</div>

<div id="calc" class="content active">
  <select id="groupSelect"></select>
  <select id="rationSelect"></select>
  <button class="add" onclick="addRation()" style="margin:10px 0;">+ Add New Ration</button>
  <input type="number" id="cows" placeholder="Number of cows" value="100">
  <div id="inputs"></div>
  <button onclick="calculate()" style="margin-top:20px;">GENERATE BATCH SHEET</button>
  <button onclick="window.print()">PRINT SHEET</button>
  <div id="result" class="result"></div>
</div>

<div id="manage" class="content">
  <input type="text" id="newGroupName" placeholder="New group name">
  <button class="add" onclick="addGroup()">+ Add Group</button>
  <div id="groupList" style="margin-top:20px;"></div>
</div>

<div id="feeds" class="content">
  <input type="text" id="newFeedName" placeholder="New ingredient name">
  <button class="add" onclick="addFeed()">+ ADD INGREDIENT</button>
  <div id="feedList"></div>
</div>

<script>
  let data = {
    feeds: [{id:1,name:"Corn Silage",dm:35},{id:2,name:"Alfalfa Haylage",dm:40},{id:3,name:"Dairy Pellet",dm:89}],
    groups: [{id:1,name:"High Group",rations:[{id:1,name:"Standard",lbs:[2500,1200,800]}]}]
  };
  try{const s=localStorage.getItem('dairyTMR_final');if(s)data=JSON.parse(s);}catch(e){}
  function save(){localStorage.setItem('dairyTMR_final',JSON.stringify(data));}

  function openTab(t){
    document.querySelectorAll('.tab,.content').forEach(x=>x.classList.remove('active'));
    document.querySelector(`[onclick="openTab('${t}')"]`).classList.add('active');
    document.getElementById(t).classList.add('active');
    if(t==='calc')renderCalc();
    if(t==='manage')renderGroups();
    if(t==='feeds')renderFeeds();
  }

  function renderCalc(){
    const gSel=document.getElementById('groupSelect');
    gSel.innerHTML=data.groups.map(g=>`<option value="${g.id}">${g.name}</option>`).join('');
    const group=data.groups.find(g=>g.id==gSel.value);
    const