<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Dairy Ration Calculator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2e7d32; margin-bottom: 20px; }
        .section { margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; margin-bottom: 10px; }
        button { background: #2e7d32; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; }
        button:hover { background: #1b5e20; }
        .feed-row { display: flex; align-items: center; margin-bottom: 10px; }
        .feed-name { flex: 1; font-weight: bold; }
        .feed-input { width: 60px; text-align: right; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        #results { margin-top: 20px; white-space: pre-wrap; background: #f9f9f9; padding: 15px; border-radius: 6px; font-family: monospace; }
        .warning { color: #d32f2f; font-weight: bold; }
        .low { color: #f57c00; }
        .high { color: #f57c00; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêÑ US Dairy Ration Calculator</h1>
        <p style="text-align: center; font-style: italic;">NRC 2021 ‚Ä¢ lb, Mcal NE‚Çó, $/cwt milk</p>

        <div class="section">
            <label for="cows">Number of Cows</label>
            <input type="number" id="cows" value="100" min="1" max="1000">

            <label for="milk">Milk Yield (lb/cow/day)</label>
            <input type="number" id="milk" value="85" step="0.1" min="0">
        </div>

        <div class="section">
            <h3>Feed Library (edit in code)</h3>
            <div id="feeds"></div>
        </div>

        <button onclick="calculateRation()">CALCULATE RATION</button>

        <div id="results" style="display: none;"></div>
    </div>

    <script>
        // === U.S. FEED LIBRARY === (edit values here!)
        const feeds = [
            { name: "Corn Silage (35% DM)", dm: 35, nel: 0.74, cp: 8.5, ndf: 42, priceTon: 48 },
            { name: "Alfalfa Haylage (40%)", dm: 40, nel: 0.68, cp: 20, ndf: 44, priceTon: 180 },
            { name: "Dry Alfalfa Hay", dm: 88, nel: 0.62, cp: 19, ndf: 48, priceTon: 220 },
            { name: "High-Moisture Corn", dm: 72, nel: 0.86, cp: 9, ndf: 12, priceTon: 165 },
            { name: "Dairy 18% Pellet", dm: 89, nel: 0.84, cp: 19, ndf: 22, priceTon: 340 },
            { name: "Soybean Meal 48%", dm: 89, nel: 0.95, cp: 53.5, ndf: 10, priceTon: 480 },
            { name: "Distillers Grains (wet)", dm: 32, nel: 0.92, cp: 30, ndf: 38, priceTon: 135 },
            { name: "Whole Cottonseed", dm: 92, nel: 0.98, cp: 24, ndf: 50, priceTon: 380 }
        ];

        // Build feed inputs dynamically
        const feedsDiv = document.getElementById('feeds');
        feeds.forEach((feed, i) => {
            const row = document.createElement('div');
            row.className = 'feed-row';
            row.innerHTML = `
                <span class="feed-name">${feed.name}</span>
                <input type="number" class="feed-input" id="pct${i}" value="0" min="0" max="100" placeholder="0">
                <span>%</span>
            `;
            feedsDiv.appendChild(row);
        });

        function calculateRation() {
            const cows = parseFloat(document.getElementById('cows').value) || 0;
            const milk = parseFloat(document.getElementById('milk').value) || 0;
            if (cows <= 0 || milk <= 0) return alert('Enter valid cows and milk yield!');

            const percents = feeds.map((_, i) => parseFloat(document.getElementById(`pct${i}`).value) || 0);
            const totalPct = percents.reduce((a, b) => a + b, 0);
            if (Math.abs(totalPct - 100) > 0.1) return alert('Percentages must add to 100%!');

            // NRC 2021 DMI (lb) for 1350 lb cow
            const fcm = milk * (0.4 + 0.15 * 3.7);
            const dmiCow = (0.372 * fcm + 4.4).toFixed(1);
            const totalDMI = (cows * dmiCow).toFixed(0);

            let results = `HERD SUMMARY
Cows: ${Math.round(cows)}
Milk: ${milk.toFixed(1)} lb/cow/day ‚Üí ${(cows * milk / 100).toFixed(1)} cwt/day
DMI needed: ${dmiCow} lb/cow ‚Üí ${totalDMI} lb total

POUNDS AS-FED REQUIRED (total herd)
`;
            let nelTotal = 0, cpTotal = 0, ndfTotal = 0, costTotal = 0;

            feeds.forEach((feed, i) => {
                if (percents[i] > 0) {
                    const dmLb = parseFloat(totalDMI) * (percents[i] / 100);
                    const lbAsFed = (dmLb / (feed.dm / 100)).toFixed(0);
                    results += `${feed.name}: ${lbAsFed} lb/day\n`;

                    nelTotal += dmLb * feed.nel;
                    cpTotal += dmLb * (feed.cp / 100);
                    ndfTotal += dmLb * (feed.ndf / 100);
                    costTotal += parseFloat(lbAsFed) * (feed.priceTon / 2000);
                }
            });

            const nel = (nelTotal / parseFloat(totalDMI)).toFixed(3);
            const cp = ((cpTotal / parseFloat(totalDMI)) * 100).toFixed(1);
            const ndf = ((ndfTotal / parseFloat(totalDMI)) * 100).toFixed(1);

            results += `\nRATION QUALITY (DM basis)
NE‚Çó: ${nel} Mcal/lb ${nel < 0.765 ? '<span class="warning">LOW!</span>' : ''}
CP: ${cp}% ${cp < 16.5 ? '<span class="low">LOW!</span>' : ''}
NDF: ${ndf}% ${ndf > 34 ? '<span class="high">HIGH!</span>' : ''}

FEED COST
Total: $${costTotal.toFixed(0)}/day
Per cow: $${(costTotal / cows).toFixed(2)}
Per cwt milk: $${(costTotal / (cows * milk / 100)).toFixed(2)}`;

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = results.replace(/<span class="warning">([^<]+)<\/span>/g, '<span class="warning">$1</span>')
                                          .replace(/<span class="low">([^<]+)<\/span>/g, '<span class="low">$1</span>')
                                          .replace(/<span class