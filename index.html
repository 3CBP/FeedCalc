<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TMR in Pounds - Blue Dairy App</title>
  <style>
    :root { --blue: #1565c0; --dark: #0d47a1; --accent: #ff9800; --red: #d32f2f; }
    body { font-family: -apple-system, sans-serif; background: var(--blue); color: white; margin: 0; padding: 0; }
    header { background: var(--dark); padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
    .tabs { display: flex; background: #1976d2; }
    .tab { flex: 1; padding: 16px; text-align: center; cursor: pointer; font-weight: bold; }
    .tab.active { background: white; color: var(--dark); border-bottom: 4px solid var(--accent); }
    .content { padding: 20px; display: none; }
    .content.active { display: block; }
    input, select { width: 100%; padding: 14px; margin: 10px 0; border: none; border-radius: 8px; font-size: 17px; background: rgba(255,255,255,0.95); color: #000; }
    button { width: 100%; padding: 16px; margin: 12px 0; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
    .calc { background: var(--accent); color: black; }
    .add { background: #4caf50; color: white; }
    .del { background: var(--red); color: white; font-size: 14px; padding: 10px; width: auto; }
    .row { display: flex; align-items: center; gap: 12px; margin: 12px 0; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; }
    .row span { flex: 1; font-weight: bold; }
    .row input { width: 100px; text-align: center; }
    .result { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; margin-top: 20px; font-family: 'Courier New', monospace; line-height: 1.8; white-space: pre-line; }
    .warn { color: #ff5252; font-weight: bold; }
    .good { color: #a5d6a7; }
  </style>
</head>
<body>
  <header>TMR in Pounds - Blue Dairy App</header>
  
  <div class="tabs">
    <div class="tab active" onclick="tab('calc')">Calculator</div>
    <div class="tab" onclick="tab('groups')">Groups</div>
    <div class="tab" onclick="tab('feeds')">Ingredients</div>
  </div>

  <div id="calc" class="content active">
    <select id="group"></select>
    <input type="number" id="cows" placeholder="Number of cows" value="100">
    <div style="display:flex;gap:10px">
      <label><input type="radio" name="mode" value="percow" checked> Per cow</label>
      <label><input type="radio" name="mode" value="total"> Total herd</label>
    </div>
    <div id="inputs"></div>
    <button class="calc" onclick="calc()">CALCULATE TMR</button>
    <div id="result" class="result"></div>
  </div>

  <div id="groups" class="content">
    <input type="text" id="newgroup" placeholder="New group name">
    <button class="add" onclick="addGroup()">Add Group</button>
    <div id="grouplist"></div>
  </div>

  <div id="feeds" class="content">
    <button class="add" onclick="addFeed()">+ Add Ingredient</button>
    <div id="feedlist"></div>
  </div>

  <script>
    let data = {groups: [], feeds: []};
    const defaults = {
      feeds: [
        {id:1,name:"Corn Silage",dm:35,nel:0.74,cp:8.5,ndf:42,price:48},
        {id:2,name:"Alfalfa Haylage",dm:40,nel:0.68,cp:20,ndf:44,price:180},
        {id:3,name:"Dairy Pellet",dm:89,nel:0.84,cp:19,ndf:22,price:340},
        {id:4,name:"Distillers Wet",dm:32,nel:0.92,cp:30,ndf:38,price:135},
        {id:5,name:"Cottonseed",dm:92,nel:0.98,cp:24,ndf:50,price:380}
      ],
      groups: [{id:1,name:"High Group",lbs:[24,12,8,6,2]}]
    };

    try { data = JSON.parse(localStorage.tmr||"{}"); } catch(e) {}
    if (!data.feeds?.length) data = JSON.parse(JSON.stringify(defaults));
    if (!data.groups?.length) data.groups.push({id:1,name:"Main",lbs:new Array(data.feeds.length).fill(0)});

    function save() { localStorage.tmr = JSON.stringify(data); }

    function tab(t) {
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      document.querySelectorAll('.content').forEach(x=>x.classList.remove('active'));
      document.querySelector(`[onclick="tab('${t}')"]`).classList.add('active');
      document.getElementById(t).classList.add('active');
      if(t==='calc') render();
      if(t==='groups') renderGroups();
      if(t==='feeds') renderFeeds();
    }

    function render() {
      document.getElementById('group').innerHTML = data.groups.map(g=>`<option value="${g.id}">${g.name}</option>`).join('');
      const g = data.groups.find(x=>x.id==document.getElementById('group').value);
      let html = '';
      data.feeds.forEach((f,i) => {
        html += `<div class="row">
          <span>${f.name}</span>
          <input type="number" id="lb${i}" value="${g.lbs[i]||0}" step="0.1">
          <span>lb</span>
        </div>`;
      });
      document.getElementById('inputs').innerHTML = html;
    }